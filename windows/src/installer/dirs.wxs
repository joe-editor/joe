<?xml version="1.0" encoding="UTF-8"?>
<!--
   This file is part of Joe's Own Editor for Windows.
   Copyright (c) 2020 John J. Jordan.
 
   Joe's Own Editor for Windows is free software: you can redistribute it
   and/or modify it under the terms of the GNU General Public License as
   published by the Free Software Foundation, either version 2 of the
   License, or (at your option) any later version.
 
   Joe's Own Editor for Windows is distributed in the hope that it will
   be useful, but WITHOUT ANY WARRANTY; without even the implied warranty
   of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.
 
   You should have received a copy of the GNU General Public License
   along with Joe's Own Editor for Windows.  If not, see
   <http://www.gnu.org/licenses/>.
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <?include properties.wxi ?>
  
  <Fragment>
    <!-- Directories -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PlatformProgramFilesFolder)">
	<Directory Id="INSTALLFOLDER" Name="JoeEditor">
	  <Directory Id="SYNTAXFOLDER" Name="syntax" />
	  <Directory Id="CONFIGFOLDER" Name="conf" />
	  <Directory Id="COLORFOLDER" Name="colors" />
	  <Directory Id="DOCFOLDER" Name="doc" />
	  <Directory Id="VTFOLDER" Name="vt" />
	  <Directory Id="POFOLDER" Name="po" />
	</Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
	<Directory Id="StartMenuShortcuts" Name="Joe's Own Editor$(var.BitSuffix)">
	  <Directory Id="DocShortcutsDir" Name="Documentation" />
	</Directory>
      </Directory>
    </Directory>

    <!-- Start menu shortcut directories -->
    <Component Id="StartMenuShortcutsDirComponent" Guid="*" Directory="StartMenuShortcuts" Win64="$(var.Win64)">
      <RemoveFolder Id="StartMenuShortcuts" On="uninstall" />
      <RegistryKey Root="HKCU" Key="Software\JoeEditor" ForceDeleteOnUninstall="yes" ForceCreateOnInstall="yes">
	<RegistryValue Type="string" Name="InstallDir" Value="[INSTALLFOLDER]" />
      </RegistryKey>
    </Component>

    <Component Id="DocShortcutsComponent" Guid="*" Directory="DocShortcutsDir" Win64="$(var.Win64)">
      <RemoveFolder Id="DocShortcutsDir" On="uninstall" />
      <RegistryValue Root="HKCU" Key="Software\JoeEditor" Name="docshortcuts" Type="integer" Value="1" KeyPath="yes" />
    </Component>

    <!-- Add to %PATH% -->
    <ComponentGroup Id="AddToPathComponentGroup">
      <Component Id="PathEnvComponentMachine" Guid="*" Directory="INSTALLFOLDER" Win64="$(var.Win64)">
	<!-- PerMachine -->
	<Condition>
	  <![CDATA[ALLUSERS="1" OR (ALLUSERS="2" AND MSIINSTALLPERUSER="")]]>
	</Condition>

	<Environment Action="set" Id="SetPathToInstallFolderMachine"
		     Name="PATH" System="yes" Value="[INSTALLFOLDER]" Permanent="no" Part="last" />

	<RegistryKey Root="HKLM" Key="Software\JoeEditor" ForceDeleteOnUninstall="yes" ForceCreateOnInstall="yes">
	  <RegistryValue Type="string" Name="EnvPath" Value="1" />
	</RegistryKey>
      </Component>

      <Component Id="PathEnvComponentUser" Guid="*" Directory="INSTALLFOLDER" Win64="$(var.Win64)">
	<!-- PerUser -->
	<Condition>
	  <![CDATA[ALLUSERS="" OR (ALLUSERS="2" AND MSIINSTALLPERUSER="1")]]>
	</Condition>

	<Environment Action="set" Id="SetPathToInstallFolderUser"
		     Name="PATH" System="no" Value="[INSTALLFOLDER]" Permanent="no" Part="last" />

	<RegistryKey Root="HKCU" Key="Software\JoeEditor" ForceDeleteOnUninstall="yes" ForceCreateOnInstall="yes">
	  <RegistryValue Type="string" Name="EnvPath" Value="1" />
	</RegistryKey>
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>
