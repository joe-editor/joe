<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <!-- Default configuration if not supplied (commandline build) -->
    <Configuration Condition="'$(Configuration)' == ''">Debug</Configuration>
    <Platform Condition="'$(Platform)' == ''">Win32</Platform>
    
    <!-- Pick latest present VS version if not supplied -->
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\18.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">18.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\17.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">17.0</VisualStudioVersion>
    <!-- The above don't yet exist ... these are real: -->
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\16.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">16.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\15.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">15.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\14.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">14.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\13.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">13.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\12.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">12.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == '' and '$([MSBuild]::GetRegistryValueFromView(`HKCU\Software\Microsoft\VisualStudio\11.0`, `VisualStudioLocation`, `dne`, RegistryView.Registry32))' != 'dne'">11.0</VisualStudioVersion>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == ''">10.0</VisualStudioVersion>

    <!-- Only target XP on 32-bit builds -->
    <_ToolsetSuffix Condition="'$(Platform)' == 'Win32'">_xp</_ToolsetSuffix>

    <!-- VS 2010 -->
    <PlatformToolset Condition="'$(PlatformToolset)' == '' and '$(VisualStudioVersion)' == '10.0'">v100</PlatformToolset>

    <!-- VS 2017 -->
    <PlatformToolset Condition="'$(PlatformToolset)' == '' and '$(VisualStudioVersion)' == '15.0'">v141$(_ToolsetSuffix)</PlatformToolset>

    <!-- VS 2019 -->
    <PlatformToolset Condition="'$(PlatformToolset)' == '' and '$(VisualStudioVersion)' == '16.0' and '$(Platform)' == 'Win32'">v141_xp</PlatformToolset>
    <PlatformToolset Condition="'$(PlatformToolset)' == '' and '$(VisualStudioVersion)' == '16.0' and '$(Platform)' == 'x64'">v142</PlatformToolset>

    <!-- VS 2012, 2013, 2015 -->
    <PlatformToolset Condition="'$(PlatformToolset)' == ''">v$([System.String]::Copy('$(VisualStudioVersion)').Replace('.', ''))$(_ToolsetSuffix)</PlatformToolset>
  </PropertyGroup>

  <PropertyGroup>
	<JoeRoot>$(MSBuildThisFileDirectory)\..\..\..</JoeRoot>
	<JoeWinRoot>$(MSBuildThisFileDirectory)\..</JoeWinRoot>
	<BinaryRoot>$(JoeWinRoot)\..\bin</BinaryRoot>
	<JoeExternalSrcDir>$(JoeRoot)\joe</JoeExternalSrcDir>
	<PuttyExternalSrcDir>$(JoeWinRoot)\putty\putty</PuttyExternalSrcDir>
	<JoeWinSrcDir>$(JoeWinRoot)\joewin\win</JoeWinSrcDir>
	<JoeWinCommonSrcDir>$(JoeWinRoot)\common</JoeWinCommonSrcDir>
	<JoeSrcDir>$(JoeWinRoot)\joe\win</JoeSrcDir>
	<PuttySrcDir>$(JoeWinRoot)\putty\win</PuttySrcDir>
	<JoeConfDir>$(JoeWinRoot)\..\rc</JoeConfDir>
	<JoeSyntaxDir>$(JoeRoot)\syntax</JoeSyntaxDir>
	<JoeDocsDir>$(JoeWinRoot)\..\docs</JoeDocsDir>
	<JoeWinColorsDir>$(JoeWinRoot)\..\colors</JoeWinColorsDir>
	<JoeLangDir>$(JoeRoot)\po</JoeLangDir>
	<JoeRootConfDir>$(JoeRoot)\rc</JoeRootConfDir>
	<JoeRootDocsDir>$(JoeRoot)\docs</JoeRootDocsDir>
	<JoeColorsDir>$(JoeRoot)\colors</JoeColorsDir>
  </PropertyGroup>
  
  <PropertyGroup>
    <PlatformDir Condition="'$(Platform)' == 'Win32'">x86</PlatformDir>
    <PlatformDir Condition="'$(Platform)' == 'x86'">x86</PlatformDir>
    <PlatformDir Condition="'$(Platform)' == 'x64'">x64</PlatformDir>
    <OutputRootDir>$(BinaryRoot)\$(PlatformDir)\$(Configuration)</OutputRootDir>
    <StandaloneDir Condition="'$(IsStandalone)' != ''">\Standalone</StandaloneDir>
    <OutDir Condition="'$(WriteOutputToRoot)' == ''">$(OutputRootDir)$(StandaloneDir)\Object\$(RootNamespace)\</OutDir>
    <OutDir Condition="'$(WriteOutputToRoot)' != ''">$(OutputRootDir)$(StandaloneDir)\</OutDir>
    <IntDir>$(OutputRootDir)$(StandaloneDir)\Intermediate\$(RootNamespace)\</IntDir>
    <IntermediateOutputPath>$(IntDir)</IntermediateOutputPath>
    
    <VersionDir>$(OutputRootDir)\Intermediate\version</VersionDir>
    <ColorsOutDir>$(OutputRootDir)\colors</ColorsOutDir>
    <SyntaxOutDir>$(OutputRootDir)\syntax</SyntaxOutDir>
    <ConfOutDir>$(OutputRootDir)\conf</ConfOutDir>
    <VTOutDir>$(OutputRootDir)\vt</VTOutDir>
    <DocOutDir>$(OutputRootDir)\doc</DocOutDir>
  </PropertyGroup>
  
  <PropertyGroup>
    <FrontendDependencies>comctl32.lib;imm32.lib;winmm.lib;$(OutputRootDir)\Intermediate\joewincommon\resources.res</FrontendDependencies>
  </PropertyGroup>

  <Import Condition="'$(OutputType)' != 'Package'" Project="$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  <Import Condition="'$(OutputType)' != 'Package'" Project="$(VCTargetsPath)\Microsoft.Cpp.props" />
  <Import Condition="'$(OutputType)' != 'Package'" Project="$(VCTargetsPath)\BuildCustomizations\masm.props" />
  <Import Project="version.props" />
</Project>
